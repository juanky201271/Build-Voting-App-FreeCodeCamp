(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{203:function(t,e,n){"use strict";n.r(e);var a=n(75),r=n.n(a),o=n(0),s=n.n(o),c=n(4),i=n.n(c),u=n(10),l=n(6),p=n(7),d=n(8),f=n(9),h=n(14),m=n(19),v=n(2),b=n(3),w=n(76),g=n.n(w);function x(){var t=Object(v.a)([""]);return x=function(){return t},t}var E=b.a.a.attrs({className:"navbar-brand"})(x()),j=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return s.a.createElement(E,{href:"https://reactjs.org/",target:"_blank"},s.a.createElement("img",{src:g.a,width:"50",height:"50",alt:"Build a voting App - FreeCodeCamp"}))}}]),n}(o.Component);function O(){var t=Object(v.a)(["\n  cursor: pointer;\n"]);return O=function(){return t},t}function I(){var t=Object(v.a)([""]);return I=function(){return t},t}function y(){var t=Object(v.a)([""]);return y=function(){return t},t}function k(){var t=Object(v.a)([""]);return k=function(){return t},t}var C=b.a.div.attrs({className:"collapse navbar-collapse"})(k()),B=b.a.div.attrs({className:"navbar-nav mr-auto"})(y()),_=b.a.div.attrs({className:"collapse navbar-collapse"})(I()),N=b.a.div.attrs({className:"navbar-brand"})(O()),P=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t))._handleLogoutClick=function(){window.open("http://localhost:8000/api/auth/logout","_self"),a.props.handleNotAuthenticated(),a.setState({authenticated:!1,twitterId:"",user:""})},a._handleLoginClick=function(){window.open("http://localhost:8000/api/auth/twitter","_self")},a.state={authenticated:a.props.authenticated||"",twitterId:a.props.twitterId||"",ip:a.props.ip||"",user:a.props.user||""},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("links",this.state);var t=this.state,e=t.authenticated,n=t.twitterId,a=t.ip,r=t.user;return s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{to:{pathname:"/polls",state:{authenticated:e,twitterId:n,ip:a,user:r}},className:"navbar-brand"},"Build a voting App"),s.a.createElement(C,null,s.a.createElement(B,null,s.a.createElement(_,null,s.a.createElement(h.b,{to:{pathname:"/polls",state:{authenticated:e,twitterId:n,ip:a,user:r}},className:"nav-link"},"Polls")),s.a.createElement(_,null,e?s.a.createElement(h.b,{to:{pathname:"/mypolls",state:{authenticated:e,twitterId:n,ip:a,user:r}},className:"nav-link"},"My Polls"):s.a.createElement("div",null)),s.a.createElement(_,null,e?s.a.createElement(h.b,{to:{pathname:"/poll/insert",state:{authenticated:e,twitterId:n,ip:a,user:r}},className:"nav-link"},"Create Poll"):s.a.createElement("div",null))),e?s.a.createElement(N,{onClick:this._handleLogoutClick},"Logout Twitter"):s.a.createElement(N,{onClick:this._handleLoginClick},"Login Twitter")))}}]),n}(o.Component);function S(){var t=Object(v.a)(["\n  width: 30px;\n"]);return S=function(){return t},t}function U(){var t=Object(v.a)(["\n  color: #fff;\n  background: #444;\n  padding: 5px;\n"]);return U=function(){return t},t}function A(){var t=Object(v.a)(["\n  margin-bottom: 20px;\n"]);return A=function(){return t},t}function q(){var t=Object(v.a)([""]);return q=function(){return t},t}var R=b.a.div.attrs({className:"container"})(q()),L=b.a.nav.attrs({className:"navbar navbar-expand-lg navbar-dark bg-dark"})(A()),T=b.a.div(U()),D=b.a.img(S()),H=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t))._handleNotAuthenticated=function(){a.setState({authenticated:!1,twitterId:"",user:""})},a.state={authenticated:a.props.authenticated||"",twitterId:a.props.twitterId||"",ip:a.props.ip||"",user:a.props.user||""},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("navbar",this.state);var t=this.state,e=t.authenticated,n=t.twitterId,a=t.ip,r=t.user,o=r.name||"",c=r.profileImageUrl||"";return s.a.createElement(R,null,s.a.createElement(L,null,s.a.createElement(j,null),s.a.createElement(P,{authenticated:e,twitterId:n,ip:a,user:r,handleNotAuthenticated:this._handleNotAuthenticated}),o?s.a.createElement(T,null,o):s.a.createElement("div",null),c?s.a.createElement(D,{src:c}):s.a.createElement("div",null),a?s.a.createElement(T,null,a):s.a.createElement("div",null)))}}]),n}(o.Component),V=n(48),M=n(81),Q=n(83),F=n.n(Q).a.create({baseURL:"/api"}),z={insertPoll:function(t){return F.post("/poll",t)},getAllPolls:function(){return F.get("/polls")},updatePollById:function(t,e){return F.put("/poll/".concat(t),e)},deletePollById:function(t){return F.delete("/poll/".concat(t))},getPollById:function(t){return F.get("/poll/".concat(t))},insertUser:function(t){return F.post("/user",t)},getAllUsers:function(){return F.get("/users")},updateUserById:function(t,e){return F.put("/user/id/".concat(t),e)},updateUserByIp:function(t,e){return F.put("/user/ip/".concat(t),e)},deleteUserById:function(t){return F.delete("/user/id/".concat(t))},deleteUserByIp:function(t){return F.delete("/user/ip/".concat(t))},getUserById:function(t){return F.get("/user/id/".concat(t))},getUserByIp:function(t){return F.get("/user/ip/".concat(t))},getAllUsersTwitter:function(){return F.get("/userstwitter")},updateUserByTwitterId:function(t,e){return F.put("/usertwitter/id/".concat(t),e)},getUserByTwitterId:function(t){return F.get("/usertwitter/id/".concat(t))}},G=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).componentDidMount=Object(u.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.state._id,t.next=3,z.getPollById(e).then((function(t){for(var e=t.data.data.answers.map((function(t,e){return t.answer})),n=t.data.data.question,r=t.data.data.answers.map((function(t,e){return t.votes})),o=[],s=[],c=a.colors18.length,i=0,u=0;u<t.data.data.answers.length;u++)o.push(a.colors18[u]),s.push(a.colors18[u].substr(0,2)+a.colors18[u].substr(3,1)+a.colors18[u].substr(5,1)),++i===c&&(i=0);var l={labels:Object(V.a)(e),datasets:[{label:n,backgroundColor:o,hoverBackgroundColor:s,data:Object(V.a)(r)}]};a.setState({dataChart:l,question:n})})).catch((function(t){console.log(t)}));case 3:case"end":return t.stop()}}),t)}))),a.state={_id:a.props._id,dataChart:{},question:""},a.colors18=["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],a}return Object(p.a)(n,[{key:"render",value:function(){var t=this.state,e=t.dataChart,n=t.question;return s.a.createElement("div",null,s.a.createElement(M.a,{data:e,options:{title:{display:!1,text:"Chart of Poll: "+n,fontSize:20},legend:{display:!0,position:"right"}}}))}}]),n}(o.Component),J=n(34);n(74);function Y(){var t=Object(v.a)([""]);return Y=function(){return t},t}function K(){var t=Object(v.a)([" padding: 0 40px 40px 40px; "]);return K=function(){return t},t}var W=b.a.div(K()),X=b.a.h1.attrs({className:"h1"})(Y()),Z=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).componentDidMount=Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setState({isLoading:!0}),t.next=3,fetch("/api/auth/login/success",{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Credentials":!0}}).then((function(t){if(200===t.status)return t.json();throw new Error("failed to authenticate user")})).then((function(t){!0===t.success?a.setState({authenticated:!0,twitterId:t.user.twitterId,ip:t.ip,user:t.user}):a.setState({authenticated:!1,twitterId:"",ip:t.ip,user:""})})).catch((function(t){console.log(t)}));case 3:return a.addUserIp(),t.next=6,z.getAllPolls().then((function(t){a.setState({polls:t.data.data,isLoading:!1})})).catch((function(t){console.log(t)}));case 6:case"end":return t.stop()}}),t)}))),a.addUserIp=Object(u.a)(i.a.mark((function t(){var e,n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=a.state.ip)){t.next=15;break}return t.next=4,z.getUserByIp(e).catch((function(t){return console.log(t)}));case 4:if(t.sent){t.next=13;break}return n={ip:e,votes:[]},t.next=9,z.insertUser(n).catch((function(t){return console.log(t)}));case 9:t.sent,t.next=13;break;case 13:t.next=15;break;case 15:case"end":return t.stop()}}),t)}))),a.state={polls:[],columns:[],isLoading:!1,authenticated:"",twitterId:"",ip:"",user:""},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("polls",this.state);var t=this.state,e=t.polls,n=t.isLoading,a=[{Header:"ID",accessor:"_id",filterable:!0},{Header:"Question",accessor:"question",filterable:!0},{Header:"Answers",accessor:"answers",Cell:function(t){return s.a.createElement("span",null,t.value.length>1?t.value.map((function(t,e){return t.answer})).join(" / "):t.value.map((function(t,e){return t.answer})))}},{Header:"",accessor:"",Cell:function(t){return s.a.createElement("span",null,s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{to:{pathname:"/poll/details/".concat(t.original._id),state:{authenticated:this.state.authenticated,twitterId:this.state.twitterId,ip:this.state.ip,user:this.state.user}},className:"nav-link"},"Details")))}.bind(this)}],r=!0;return e.length||(r=!1),s.a.createElement(W,null,s.a.createElement(X,null,"Polls"),r&&!n&&s.a.createElement(J.a,{data:e,columns:a,loading:n,defaultPageSize:10,showPageSizeOptions:!0,minRows:0}))}}]),n}(o.Component);function $(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n"]);return $=function(){return t},t}function tt(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n"]);return tt=function(){return t},t}function et(){var t=Object(v.a)(["\n    margin: 5px;\n"]);return et=function(){return t},t}function nt(){var t=Object(v.a)([" margin: 5px; "]);return nt=function(){return t},t}function at(){var t=Object(v.a)(["\n    margin: 0 30px;\n"]);return at=function(){return t},t}function rt(){var t=Object(v.a)([""]);return rt=function(){return t},t}var ot=b.a.h1.attrs({className:"h1"})(rt()),st=b.a.div.attrs({className:"form-group"})(at()),ct=b.a.label(nt()),it=b.a.input.attrs({className:"form-control"})(et()),ut=b.a.button.attrs({className:"btn btn-primary"})(tt()),lt=b.a.a.attrs({className:"btn btn-danger"})($()),pt=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).handleChangeInputQuestion=function(t){var e=t.target.value;a.setState({question:e})},a.handleChangeInputAnswers=function(t){var e=t.target.value;a.setState({answers:e})},a.handleIncludePoll=Object(u.a)(i.a.mark((function t(){var e,n,r,o,s,c,u,l,p;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.state,n=e.question,r=e.answers,o=a.props.location.state,s=o.twitterId,c=o.ip,u=r.split("/"),l=[],u.map((function(t,e){return l.push({answer:t.trim(),votes:0})})),p={question:n,answers:l,ip:c,twitterId:s},t.next=8,z.insertPoll(p).then((function(t){window.alert("Poll inserted successfully"),a.setState({question:"",answers:""})})).catch((function(t){console.log(t)}));case 8:window.location.href="/mypolls";case 9:case"end":return t.stop()}}),t)}))),a.state={question:"",answers:""},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("insert",this.state);var t=this.state,e=t.question,n=t.answers;return s.a.createElement(st,null,s.a.createElement(ot,null,"Create Poll"),s.a.createElement(ct,null,"Question: "),s.a.createElement(it,{type:"text",value:e,onChange:this.handleChangeInputQuestion}),s.a.createElement(ct,null,"Answers: "),s.a.createElement(it,{type:"text",value:n,placeholder:"Separate each one with '/'...",onChange:this.handleChangeInputAnswers}),s.a.createElement(ut,{onClick:this.handleIncludePoll},"Add Poll"),s.a.createElement(lt,{href:"/mypolls"},"Cancel"))}}]),n}(o.Component);function dt(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n"]);return dt=function(){return t},t}function ft(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n    display: initial;\n"]);return ft=function(){return t},t}function ht(){var t=Object(v.a)(["\n    margin: 5px;\n"]);return ht=function(){return t},t}function mt(){var t=Object(v.a)(["\n    margin: 5px;\n"]);return mt=function(){return t},t}function vt(){var t=Object(v.a)(["\n    margin: 0 30px;\n"]);return vt=function(){return t},t}function bt(){var t=Object(v.a)([""]);return bt=function(){return t},t}var wt=b.a.h1.attrs({className:"h1"})(bt()),gt=b.a.div.attrs({className:"form-group"})(vt()),xt=b.a.label(mt()),Et=b.a.input.attrs({className:"form-control"})(ht()),jt=b.a.button.attrs({className:"btn btn-primary"})(ft()),Ot=b.a.a.attrs({className:"btn btn-danger"})(dt()),It=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).handleChangeInputQuestion=function(t){var e=t.target.value;a.setState({question:e})},a.handleChangeInputAnswers=function(t){var e=t.target.value;a.setState({answers:e})},a.handleUpdatePoll=Object(u.a)(i.a.mark((function t(){var e,n,r,o,s,c,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.state,n=e._id,r=e.question,o=e.answers,s=o.split("/"),c=[],s.map((function(t,e){return c.push({answer:t.trim(),votes:0})})),u={question:r,answers:c},t.next=7,z.updatePollById(n,u).then((function(t){window.alert("Poll updated successfully"),a.setState({question:"",answers:[],votes:[]})})).catch((function(t){console.log(t)}));case 7:window.location.href="/mypolls";case 8:case"end":return t.stop()}}),t)}))),a.componentDidMount=Object(u.a)(i.a.mark((function t(){var e,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.state,n=e._id,r=e.votes,t.next=3,z.getPollById(n).then((function(t){r=t.data.data.answers.map((function(t,e){return t.votes})),a.setState({question:t.data.data.question,answers:t.data.data.answers.map((function(t,e){return t.answer.trim()})).join(" / "),votes:t.data.data.answers.map((function(t,e){return t.votes}))})})).catch((function(t){console.log(t)}));case 3:r.filter((function(t,e){return t>0})).length>0&&a.updateButtonRef.current&&(a.updateButtonRef.current.style.display="none");case 5:case"end":return t.stop()}}),t)}))),a.state={_id:a.props.match.params._id,question:"",answers:"",votes:[]},a.updateButtonRef=s.a.createRef(),a}return Object(p.a)(n,[{key:"render",value:function(){console.log("update",this.state);var t=this.state,e=t.question,n=t.answers;return s.a.createElement(gt,null,s.a.createElement(wt,null,"Update Poll"),s.a.createElement(xt,null,"Question: "),s.a.createElement(Et,{type:"text",value:e,onChange:this.handleChangeInputQuestion}),s.a.createElement(xt,null,"Answers: "),s.a.createElement(Et,{type:"text",value:n,placeholder:"Separate each one with '/'...",onChange:this.handleChangeInputAnswers}),s.a.createElement(jt,{id:"updateButton",onClick:this.handleUpdatePoll,ref:this.updateButtonRef},"Update Poll"),s.a.createElement(Ot,{href:"/mypolls"},"Cancel"))}}]),n}(o.Component);function yt(){var t=Object(v.a)([" color: #ff0000; cursor: pointer; "]);return yt=function(){return t},t}function kt(){var t=Object(v.a)([""]);return kt=function(){return t},t}function Ct(){var t=Object(v.a)([" padding: 0 40px 40px 40px; "]);return Ct=function(){return t},t}var Bt=b.a.div(Ct()),_t=b.a.h1.attrs({className:"h1"})(kt()),Nt=b.a.div(yt()),Pt=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).deleteUser=function(){var e=Object(u.a)(i.a.mark((function e(n){var a,r,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),a=t.props,r=a.twitterId,o=a.ip,s=a._id,!window.confirm("Do tou want to delete the poll ".concat(s," permanently?"))){e.next=10;break}return e.next=5,z.deletePollById(s).catch((function(t){console.log(t)}));case 5:return e.next=7,z.getAllUsersTwitter().then((function(t){t.data.data.forEach((function(t,e){var n=!1,a=t.votes.map((function(t,e){return t.poll_id===s?(n=!0,{poll_id:"",answer:""}):{poll_id:t.poll_id,answer:t.answer}}));if(n){var o={votes:a};z.updateUserByTwitterId(r,o).catch((function(t){console.log(t)}))}}))})).catch((function(t){console.log(t)}));case 7:return e.next=9,z.getAllUsers().then((function(t){t.data.data.forEach((function(t,e){var n=!1,a=t.votes.map((function(t,e){return t.poll_id===s?(n=!0,{poll_id:"",answer:""}):{poll_id:t.poll_id,answer:t.answer}}));if(n){var r={votes:a};z.updateUserByIp(o,r).catch((function(t){console.log(t)}))}}))})).catch((function(t){console.log(t)}));case 9:window.location.reload();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}return Object(p.a)(n,[{key:"render",value:function(){return s.a.createElement(Nt,{onClick:this.deleteUser},"Delete")}}]),n}(o.Component),St=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).componentDidMount=Object(u.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setState({isLoading:!0}),e=a.props.location.state.twitterId,t.next=4,z.getAllPolls().then((function(t){var n=t.data.data;n=e?n.filter((function(t){return t.twitterId===e.toString()})):[],a.setState({polls:n,isLoading:!1})})).catch((function(t){console.log(t)}));case 4:case"end":return t.stop()}}),t)}))),a.state={polls:[],columns:[],isLoading:!1},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("my polls",this.state);var t=this.state,e=t.polls,n=t.isLoading,a=[{Header:"ID",accessor:"_id",filterable:!0},{Header:"Question",accessor:"question",filterable:!0},{Header:"Answers",accessor:"answers",Cell:function(t){return s.a.createElement("span",null,t.value.length>1?t.value.map((function(t,e){return t.answer})).join(" / "):t.value.map((function(t,e){return t.answer})))}},{Header:"",accessor:"",Cell:function(t){return s.a.createElement("span",null,s.a.createElement(Pt,{_id:t.original._id,authenticated:this.props.location.state.authenticated,twitterId:this.props.location.state.twitterId,ip:this.props.location.state.ip,user:this.props.location.state.user}))}.bind(this)},{Header:"",accessor:"",Cell:function(t){return s.a.createElement("span",null,s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{to:{pathname:"/poll/update/".concat(t.original._id),state:{authenticated:this.props.location.state.authenticated,twitterId:this.props.location.state.twitterId,ip:this.props.location.state.ip,user:this.props.location.state.user}},className:"nav-link"},"Update")))}.bind(this)},{Header:"",accessor:"",Cell:function(t){return s.a.createElement("span",null,s.a.createElement(s.a.Fragment,null,s.a.createElement(h.b,{to:{pathname:"/poll/details/".concat(t.original._id),state:{authenticated:this.props.location.state.authenticated,twitterId:this.props.location.state.twitterId,ip:this.props.location.state.ip,user:this.props.location.state.user}},className:"nav-link"},"Details")))}.bind(this)}],r=!0;return e.length||(r=!1),s.a.createElement(Bt,null,s.a.createElement(_t,null,"My Polls"),r&&!n&&s.a.createElement(J.a,{data:e,columns:a,loading:n,defaultPageSize:10,showPageSizeOptions:!0,minRows:0}))}}]),n}(o.Component);function Ut(){var t=Object(v.a)(["\n    margin: 5px;\n"]);return Ut=function(){return t},t}function At(){var t=Object(v.a)(["\n    margin: 5px;\n    display: none;\n"]);return At=function(){return t},t}function qt(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n"]);return qt=function(){return t},t}function Rt(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n    display: initial;\n"]);return Rt=function(){return t},t}function Lt(){var t=Object(v.a)(["\n    margin: 15px 15px 15px 5px;\n    display: initial;\n"]);return Lt=function(){return t},t}function Tt(){var t=Object(v.a)(["\n    margin: 5px;\n    color: green;\n    font-weight: bold;\n"]);return Tt=function(){return t},t}function Dt(){var t=Object(v.a)(["\n    margin: 5px;\n    color: DodgerBlue;\n"]);return Dt=function(){return t},t}function Ht(){var t=Object(v.a)(["\n    margin: 5px;\n"]);return Ht=function(){return t},t}function Vt(){var t=Object(v.a)(["\n    margin: 0 30px;\n    float: left;\n    width: 40%;\n"]);return Vt=function(){return t},t}function Mt(){var t=Object(v.a)(["\n    margin: 0 30px;\n    float: rigth;\n    width: 40%;\n"]);return Mt=function(){return t},t}function Qt(){var t=Object(v.a)(["\n    margin: 0 30px;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    align-items: center;\n"]);return Qt=function(){return t},t}function Ft(){var t=Object(v.a)([""]);return Ft=function(){return t},t}var zt=b.a.h1.attrs({className:"h1"})(Ft()),Gt=b.a.div.attrs({className:"form-group"})(Qt()),Jt=b.a.div.attrs({className:"form-group"})(Mt()),Yt=b.a.div.attrs({className:"form-group"})(Vt()),Kt=b.a.label(Ht()),Wt=b.a.label(Dt()),Xt=b.a.label(Tt()),Zt=b.a.button.attrs({className:"btn btn-info"})(Lt()),$t=b.a.button.attrs({className:"btn btn-primary"})(Rt()),te=b.a.a.attrs({className:"btn btn-danger"})(qt()),ee=b.a.input.attrs({className:"form-control"})(At()),ne=b.a.input.attrs({type:"radio"})(Ut()),ae=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).handleChangeInputVote=function(){var t=Object(u.a)(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.target.value,a.setState({vote:n}),"extraOption"===e.target.id?a.extraInputRef.current.style.display="initial":a.extraInputRef.current.style.display="none";case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),a.handleChangeInputExtraOption=function(t){var e=t.target.value;a.setState({extraOption:e})},a.handleVotePoll=Object(u.a)(i.a.mark((function t(){var e,n,r,o,s,c,u,l,p,d,f,h,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.state,n=e._id,r=e.question,o=e.answers,s=e.extraOption,c=e.vote,u=e.authenticated,l=e.twitterId,p=e.ip,c){t.next=3;break}return t.abrupt("return");case 3:if(s||"I'd like a custom option"!==c.trim()){t.next=5;break}return t.abrupt("return");case 5:return d=[],o.map((function(t,e){return t.answer.trim()===c.trim()?d.push({answer:t.answer.trim(),votes:t.votes+1}):d.push({answer:t.answer.trim(),votes:t.votes})})),s&&"I'd like a custom option"===c.trim()&&d.push({answer:s,votes:1}),f={question:r,answers:d},t.next=11,z.updatePollById(n,f).then((function(t){window.alert("Poll voted successfully")})).catch((function(t){console.log(t)}));case 11:if(d=[],!u){t.next=20;break}return t.next=15,z.getUserByTwitterId(l).then((function(t){(d=t.data.data.votes||[]).push({poll_id:n,answer:"I'd like a custom option"===c.trim()?s:c.trim()})})).catch((function(t){console.log(t)}));case 15:return h={votes:d},t.next=18,z.updateUserByTwitterId(l,h).catch((function(t){console.log(t)}));case 18:t.next=25;break;case 20:return t.next=22,z.getUserByIp(p).then((function(t){(d=t.data.data.votes||[]).push({poll_id:n,answer:"I'd like a custom option"===c.trim()?s:c.trim()})})).catch((function(t){console.log(t)}));case 22:return m={votes:d},t.next=25,z.updateUserByIp(p,m).catch((function(t){console.log(t)}));case 25:window.location.href="/mypolls";case 26:case"end":return t.stop()}}),t)}))),a.componentDidMount=Object(u.a)(i.a.mark((function t(){var e,n,r,o,c,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.state,n=e._id,r=e.authenticated,o=e.twitterId,c=e.ip,u=e.userVotes,!r){t.next=6;break}return t.next=4,z.getUserByTwitterId(o).then((function(t){u=t.data.data.votes||[],a.setState({userVotes:t.data.data.votes||[]})})).catch((function(t){console.log(t)}));case 4:t.next=8;break;case 6:return t.next=8,z.getUserByIp(c).then((function(t){u=t.data.data.votes||[],a.setState({userVotes:t.data.data.votes||[]})})).catch((function(t){console.log(t)}));case 8:return t.next=10,z.getPollById(n).then((function(t){var e=t.data.data.answers.map((function(t,e){return s.a.createElement("div",{key:t.toString().substr(0,5)+e.toString()},s.a.createElement(ne,{id:t.answer.trim(),name:"options",value:t.answer.trim(),onChange:a.handleChangeInputVote}),u.filter((function(e,a){return e.poll_id===n&&e.answer.trim()===t.answer.trim()})).length>0?s.a.createElement(Xt,null,t.answer.trim()+" ..... ("+t.votes+"). Your VOTE."):s.a.createElement(Kt,null,t.answer.trim()+" ..... ("+t.votes+")."))}));e.push(s.a.createElement("div",{key:"extraOption"},s.a.createElement(ne,{id:"extraOption",name:"options",value:"I'd like a custom option",onChange:a.handleChangeInputVote}),s.a.createElement(Wt,null,"I'd like a custom option"))),a.setState({question:t.data.data.question,answersHtml:e,answers:t.data.data.answers})})).catch((function(t){console.log(t)}));case 10:!r&&a.shareButtonRef.current&&(a.shareButtonRef.current.style.display="none"),u.filter((function(t,e){return t.poll_id===n})).length>0&&a.updateButtonRef.current&&(a.updateButtonRef.current.style.display="none");case 13:case"end":return t.stop()}}),t)}))),a.state={_id:a.props.match.params._id,authenticated:a.props.location.state.authenticated,twitterId:a.props.location.state.twitterId,ip:a.props.location.state.ip,user:a.props.location.state.user,question:"",answers:"",vote:"",extraOption:"",userVotes:[]},a.updateButtonRef=s.a.createRef(),a.shareButtonRef=s.a.createRef(),a.extraInputRef=s.a.createRef(),a}return Object(p.a)(n,[{key:"handleShare",value:function(t){window.open(t,"_blank")}},{key:"render",value:function(){var t=this;console.log("details",this.state);var e=this.state,n=e.question,a=e.answersHtml,r=e._id,o="https://twitter.com/intent/tweet?url=http://localhost:8000/poll/details/"+this.props.match.params._id+"&text="+n+" - BVA-jccc-fcc";return s.a.createElement(Gt,null,s.a.createElement(Yt,null,s.a.createElement(zt,null,"Poll Details"),s.a.createElement(Kt,null,n),a,s.a.createElement(ee,{type:"text",id:"extraInput",value:this.state.extraOption,placeholder:"write some other option",onChange:this.handleChangeInputExtraOption,ref:this.extraInputRef}),s.a.createElement($t,{onClick:this.handleVotePoll,id:"updateButton",ref:this.updateButtonRef},"Vote"),s.a.createElement(te,{href:"/mypolls"},"Cancel"),s.a.createElement(Zt,{onClick:function(){return t.handleShare(o)},id:"shareButton",ref:this.shareButtonRef},"Share on Twitter")),s.a.createElement(Jt,null,s.a.createElement(G,{_id:r})))}}]),n}(o.Component),re=(n(202),function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).componentDidMount=Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.setState({isLoading:!0}),t.next=3,fetch("/api/auth/login/success",{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Credentials":!0}}).then((function(t){if(200===t.status)return t.json();throw new Error("failed to authenticate user")})).then((function(t){!0===t.success?a.setState({authenticated:!0,twitterId:t.user.twitterId,ip:t.ip,user:t.user}):a.setState({authenticated:!1,twitterId:"",ip:t.ip,user:""})})).catch((function(t){console.log(t)}));case 3:a.addUserIp(),a.setState({isLoading:!1});case 5:case"end":return t.stop()}}),t)}))),a.addUserIp=Object(u.a)(i.a.mark((function t(){var e,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.state||"",!(n=e.ip)){t.next=15;break}return t.next=4,z.getUserByIp(n).catch((function(t){return console.log(t)}));case 4:if(t.sent){t.next=13;break}return r={ip:n,votes:[]},t.next=9,z.insertUser(r).catch((function(t){return console.log(t)}));case 9:t.sent,t.next=13;break;case 13:t.next=15;break;case 15:case"end":return t.stop()}}),t)}))),a.state={authenticated:!1,twitterId:"",ip:"",user:"",isLoading:!1},a}return Object(p.a)(n,[{key:"render",value:function(){console.log("app",this.state);var t=this.state,e=t.authenticated,n=t.twitterId,a=t.ip,r=t.user,o=t.isLoading;return s.a.createElement(h.a,null,o?s.a.createElement("div",null):e?s.a.createElement(s.a.Fragment,null,s.a.createElement(H,{authenticated:e,twitterId:n,ip:a,user:r}),s.a.createElement(m.d,null,s.a.createElement(m.b,{path:"/polls",exact:!0,component:Z}),s.a.createElement(m.b,{path:"/poll/insert",exact:!0,component:pt}),s.a.createElement(m.b,{path:"/poll/update/:_id",exact:!0,component:It}),s.a.createElement(m.b,{path:"/poll/details/:_id",exact:!0,component:ae}),s.a.createElement(m.b,{path:"/mypolls",exact:!0,component:St}),s.a.createElement(m.b,{exact:!0,path:"/",render:function(){return s.a.createElement(m.a,{to:"/polls"})}}),s.a.createElement(m.b,{path:"*",component:Z}))):s.a.createElement(s.a.Fragment,null,s.a.createElement(H,{authenticated:e,twitterId:n,ip:a,user:r}),s.a.createElement(m.d,null,s.a.createElement(m.b,{path:"/polls",exact:!0,component:Z}),s.a.createElement(m.b,{path:"/poll/details/:_id",exact:!0,component:ae}),s.a.createElement(m.b,{exact:!0,path:"/",render:function(){return s.a.createElement(m.a,{to:"/polls"})}}),s.a.createElement(m.b,{path:"*",component:Z}))))}}]),n}(o.Component));r.a.render(s.a.createElement(re,null),document.getElementById("root"))},76:function(t,e,n){t.exports=n.p+"static/media/logo.5d5d9eef.svg"},85:function(t,e,n){t.exports=n(203)}},[[85,1,2]]]);
//# sourceMappingURL=main.dcfece06.chunk.js.map